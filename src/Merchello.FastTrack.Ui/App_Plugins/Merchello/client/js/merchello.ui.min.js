/*! MUI
 * https://merchello.com
 * Copyright (c) 2016 Accross the Pond, LLC.
 * Licensed 
 */



var MUI=function(){function a(){$(document).ready(function(){MUI.Logger.init(),MUI.Notify.init(),MUI.AddItem.init(),MUI.Basket.init(),MUI.Checkout.init(),MUI.Labels.init()})}function b(){return MUI.Logger.hasLogger}function c(a,b){try{var c=_.find(j,function(b){return b.event===a});if(void 0!==c&&null!==c)void 0!==b&&"function"==typeof b&&c.callbacks.push(b);else{var d=[];void 0!==b&&"function"==typeof b&&d.push(b),j.push({event:a,callbacks:d})}}catch(e){MUI.Logger.captureError(e)}}function d(a,b){var c=_.find(j,function(b){return b.event===a});void 0!==c&&null!==c&&_.each(c.callbacks,function(c){try{c(a,b)}catch(d){MUI.Logger.captureError(d,{extra:{eventName:a,args:b}})}})}function e(a){var b={};return function(c,d){return b[c]||(b[c]=$.Deferred(function(b){a(b,c)}).promise()),b[c].done(d)}}function f(a,b){var c=_.find(a,function(a){return a.alias===b});return void 0===c?"":c.name}function g(a){i.events&&_.each(a,function(a){MUI.on(a.name,function(b,c){console.info(a),console.info(void 0===c?"No args":c)})})}function h(a){i.console&&console.info(a)}var i={events:!0,console:!0},j=[];return{Settings:{Notifications:{},Endpoints:{}},Services:{},init:a,hasLogger:b,createCache:e,on:c,emit:d,getEventNameByAlias:f,debugConsoleEvents:g,debugConsole:h}}();MUI.Logger={hasLogger:!1,init:function(){},setSiteContext:function(a){},setUserContext:function(a){},captureError:function(a,b){var c=void 0===b?a:{error:a,args:b};MUI.debugConsole(c)},captureMessage:function(a,b){var c=void 0===b?message:{message:a,args:b};MUI.debugConsole(c)},isReady:function(){return MUI.Logger.hasLogger}},MUI.Services.Braintree={initialized:!1,acceptCards:[],currentCardType:"",events:[{attempt:"unbindValidation",name:"Braintree.UnbindValidation"},{attempt:"cardTypeChanged",name:"Braintree.CardTypeChange"},{attempt:"verified",name:"Braintree.CardVerified"}],loadAssets:function(a){$.when(MUI.Assets.cachedGetScript("/App_Plugins/Merchello/client/lib/card-validator.min.js"),MUI.Assets.cachedGetScript("//js.braintreegateway.com/v2/braintree.js")).then(function(){MUI.Services.Braintree.initialized=!0,void 0!==a&&a()},function(a){MUI.Logger.captureError(a)})},validateCard:function(a){return"object"!=typeof a?!1:MUI.Providers.Braintree.validateCardNumber(a.number)&&MUI.Providers.Braintree.validateExpires(a.expirationDate)&&MUI.Providers.Braintree.validateCvv(a.cvv)&&MUI.Providers.Braintree.validatePostalCode(a.billingAddress.postalCode)},validateCardNumber:function(a){return cardValidator.number(a)},validateExpires:function(a){return cardValidator.expirationDate(a)},validateCvv:function(a){return cardValidator.cvv(a)},validatePostalCode:function(a){return cardValidator.cvv(a)},BraintreeCreditCard:function(){var a=this;a.cardholderName="",a.number="",a.cvv="",a.expirationDate="",a.billingAddress={postalCode:""}}},MUI.AddItem={events:[{alias:"added",name:"AddItem.added"}],addItemSuccess:"Successfully added item to basket",postUrl:"",init:function(){function a(){if((void 0===MUI.Settings.Endpoints.productTableApi||""!==MUI.Settings.Endpoints.productTableApi)&&MUI.AddItem.bind.keys.length>0){var a=MUI.Settings.Endpoints.productTableApi+"PostGetProductDataTables";$.ajax({type:"POST",url:a,dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify(MUI.AddItem.bind.keys)}).then(function(a){a.length>0&&$.each(a,function(a,b){var c=new MUI.AddItem.ProductDataTable;c.productKey=b.productKey,$.each(b.rows,function(a,b){c.rows.push($.extend(new MUI.AddItem.ProductDataTableRow,b))}),MUI.AddItem.dataTables.push(c),MUI.AddItem.bind.controls(c)})},function(a){MUI.Notify.error(a),MUI.Logger.captureError(a)})}}void 0!==MUI.Settings.Endpoints.basketSurface&&""!==MUI.Settings.Endpoints.basketSurface&&(MUI.AddItem.postUrl=MUI.Settings.Endpoints.basketSurface+"AddBasketItem");var b=$('[data-muifrm="additem"]');b.length>0&&($.each(b,function(a,b){MUI.AddItem.bind.form(b)}),a()),MUI.debugConsoleEvents(MUI.AddItem.events)},bind:{keys:[],form:function(a){var b=$(a).closest("[data-muiproduct]"),c="";b.length>0&&(c=$(b).data("muiproduct"),void 0!==c&&""!==c&&MUI.AddItem.bind.keys.push(c)),""!==MUI.AddItem.postUrl&&$(a).submit(function(){return $.ajax({type:"POST",url:MUI.AddItem.postUrl,data:$(this).serialize()}).then(function(a){MUI.emit("AddItem.added",a),MUI.Notify.info("Successfully added item to basket")},function(a){MUI.Logger.captureError(a)}),!1})},controls:function(a){var b=MUI.AddItem.getOptionsForProduct(a.productKey);b.length>0&&($.each(b,function(b,c){$(c).change(function(){MUI.AddItem.updateVariantPricing(a)})}),MUI.AddItem.updateVariantPricing(a))}},dataTables:[],updateVariantPricing:function(a){var b=void 0,c=$('[data-muiproduct="'+a.productKey+'"]');if(c.length>0){if(b=$(c).find('[data-muivalue="variantprice"]'),!(b.length>0))return;b=b[0]}var d=MUI.AddItem.getOptionsForProduct(a.productKey);if(d.length>0){var e=[];if($.each(d,function(a,b){e.push($(b).val())}),e.length>0){var f=a.getRowByMatchKeys(e);if(void 0!==f){var g="";g=f.onSale?"<span class='sale-price'>"+f.formattedSalePrice+"</span><span class='original-price'>"+f.formattedPrice+"</span>":"<span>"+f.formattedPrice+"</span>",$(b).html(g)}}}},getOptionsForProduct:function(a){var b=$('[data-muiproduct="'+a+'"]');if(b.length>0){var c=$(b).find("[data-muioption]"),d=[];return $.each(c,function(a,b){d.push($(b).find("select"))}),d}return[]},getProductDataTable:function(a){return _.find(MUI.AddItem.dataTables,function(b){return b.productKey===a})}},MUI.Assets={cachedGetScript:MUI.createCache(function(a,b){$.getScript(b).then(a.resolve,a.reject)})},MUI.Basket={init:function(){if(void 0!==MUI.Settings.Endpoints.basketSurface&&""!==MUI.Settings.Endpoints.basketSurface){var a=$('[data-muifrm="basket"]');a.length>0&&MUI.Basket.bind.form(a[0])}},bind:{form:function(a){$(a).find(":input").change(function(){var a=$(this).closest("form"),b=MUI.Settings.Endpoints.basketSurface+"UpdateBasket";$.ajax({type:"POST",url:b,data:$(a).serialize()}).then(function(b){$.each(b.UpdatedItems,function(a,b){var c=$('input:hidden[value="'+b.Key+'"]');if(c.length>0){var d=$(c).closest("tr").find('[data-muivalue="linetotal"]');d.length>0&&$(d).html(b.FormattedTotal)}});var c=$(a).find('[data-muivalue="total"]');c.length>0&&$(c).html(b.FormattedTotal),MUI.emit("AddItem.added",b)},function(a){MUI.Logger.captureError(a)})});var b=$(a).find('[data-muibtn="update"]');b.length>0&&$(b).hide()}}},MUI.Checkout={init:function(){MUI.Checkout.Address.init(),MUI.Checkout.Payment.init()}},MUI.Forms={init:function(){$.validator.addMethod("validateexpiresdate",function(a,b,c){if(5!=a.length)return!1;var d=new Date,e=d.getFullYear()-2e3,f=+a.substr(0,2),g=+a.substr(3,4);return f>=1&&12>=f&&g>=e&&e+20>g&&(g==e?f>=d.getMonth()+1:!0)}),$.validator.unobtrusive.adapters.addBool("validateexpiresdate")},post:function(a,b){return MUI.resourcePromise(b,$(a).serialize())},rebind:function(a){$.validator.unobtrusive.parse(a)},validate:function(a){var b=$(a).validate(),c=!0;return $(a).find("input").each(function(){b.element(this)||(c=!1)}),c},isValidEmail:function(a){var b=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)}},MUI.Labels={init:function(){MUI.on("AddItem.added",MUI.Labels.update.basketItemCount),console.info("bound AddItem.added")},update:{basketItemCount:function(a,b){if(b.Success){var c=$('[data-muilabel="basketcount"]');c.length>0&&$(c).html(b.BasketItemCount)}}}},MUI.Notify={types:["success","info","error","warn"],enabled:!1,bar:void 0,init:function(){MUI.Notify.appendNotifyBar()},info:function(a){MUI.Notify.message(a,"info",1e3)},success:function(a){MUI.Notify.message(a,"success",500)},error:function(a){MUI.Notify.message(a,"error",1e3)},warn:function(a){MUI.Notify.message(a,"warn",750)},message:function(a,b,c){function d(){var a=MUI.Notify.bar,b=MUI.Notify.getClassRef("all");$.each(b,function(b){var c=MUI.Notify.getCssClass(b);$(a).removeClass(c)})}if(void 0!==MUI.Notify.bar&&MUI.Notify.enabled){void 0===c&&(c=500);var e=MUI.Notify.bar,f=$(e).find('[data-muivalue="nofity"]');if(f.length>0){d(),void 0===b&&(b="info");var g=MUI.Notify.getClassRef(b),h=MUI.Notify.getCssClass(g);$(e).addClass(h),$(f).html(a),$(e).fadeIn().delay(c).fadeOut()}}},getCssClass:function(a){try{var b=MUI.Settings.Notifications[a];return void 0===b?(MUI.Logger.captureMessage("Failed to find CSS class for "+a+". Returning alert-info"),"alert-info"):b}catch(c){MUI.Logger.captureError(c)}},getClassRef:function(a){if("all"===a){var b=[];return $.each(MUI.Notify.types,function(a){b.push(a+"Css")}),b}var c=_.find(MUI.Notify.types,function(b){return b===a});return void 0===c?"infoCss":a+"Css"},appendNotifyBar:function(){if(void 0!==MUI.Settings.Notifications.enabled&&MUI.Settings.Notifications.enabled===!0&&void 0!==MUI.Settings.Notifications.template&&""!==MUI.Settings.Notifications.template&&0===$('[data-muinotify="notifybar"]').length){var a=MUI.Settings.Notifications.template;$("body").append(a),MUI.Notify.bar=$('[data-muinotify="notifybar"]'),$(MUI.Notify.bar).hide(),MUI.Notify.enabled=!0}}},MUI.Utilities={EnsureNullAsValue:function(a,b){return void 0===b&&(b=""),null===a||void 0===a?b:a},getQueryStringValue:function(a,b){b||(b=window.location.href),b=b.toLowerCase(),a=a.replace(/[\[\]]/g,"\\$&").toLowerCase();var c=new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)"),d=c.exec(b);return d?d[2]?decodeURIComponent(d[2].replace(/\+/g," ")):"":void 0},CardTypes:{types:[{niceType:"Visa",type:"visa",pattern:"^4\\d*$",gaps:[4,8,12],lengths:[16],code:{name:"CVV",size:3}},{niceType:"MasterCard",type:"master-card",pattern:"^5[1-5]\\d*$",gaps:[4,8,12],lengths:[16],code:{name:"CVC",size:3}},{niceType:"American Express",type:"american-express",pattern:"^3[47]\\d*$",isAmex:!0,gaps:[4,10],lengths:[15],code:{name:"CID",size:4}},{niceType:"DinersClub",type:"diners-club",pattern:"^3(0[0-5]|[689])\\d*$",gaps:[4,10],lengths:[14],code:{name:"CVV",size:3}},{niceType:"Discover",type:"discover",pattern:"^6(011|5|4[4-9])\\d*$",gaps:[4,8,12],lengths:[16],code:{name:"CID",size:3}},{niceType:"JCB",type:"jcb",pattern:"^(2131|1800|35)\\d*$",gaps:[4,8,12],lengths:[16],code:{name:"CVV",size:3}},{niceType:"UnionPay",type:"unionpay",pattern:"^62\\d*$",gaps:[4,8,12],lengths:[16,17,18,19],code:{name:"CVN",size:3}},{niceType:"Maestro",type:"maestro",pattern:"^(50|5[6-9]|6)\\d*$",gaps:[4,8,12],lengths:[12,13,14,15,16,17,18,19],code:{name:"CVC",size:3}}],getCardType:function(a){var b,c,d={};if(!isString(a))return d;for(b in types)if(MUI.Utilities.CardTypes.hasOwnProperty(b)&&(c=MUI.Utilities.CardTypes.types[b],RegExp(c.pattern).test(a)))return clone(c);return d},getCardByType:function(a){return _.find(FRF.Utilities.CardTypes.types,function(b){return b.type===a})}}},MUI.AddItem.ProductDataTable=function(){var a=this;a.productKey="",a.rows=[]},MUI.AddItem.ProductDataTable.prototype=function(){function a(a){var b=_.find(this.rows,function(b){var c=_.intersection(b.matchKeys,a);return c.length===a.length});return b}return{getRowByMatchKeys:a}}(),MUI.AddItem.ProductDataTableRow=function(){var a=this;a.productKey="",a.productVariantKey="",a.sku="",a.isForVariant=!1,a.onSale=!1,a.salePrice=0,a.salePriceIncVat=0,a.price=0,a.priceIncVat=0,a.isAvailable=!0,a.matchKeys=[],a.inventoryCount=0,a.outOfStockPurchase=!1},MUI.Checkout.Address={addressType:"",init:function(){}},MUI.Checkout.Payment={invoiceKey:"",token:"",events:[{alias:"btpaypalsuccess",name:"BraintreePayPal.success"}],init:function(){var a=MUI.Checkout.Payment.getBraintreeForm();$(a).length>0&&(MUI.Services.Braintree.initialized?MUI.Checkout.Payment.bind.allForms():MUI.Services.Braintree.loadAssets(function(){MUI.Checkout.Payment.bind.allForms()}))},bind:{allForms:function(){MUI.Checkout.Payment.bind.btstandard.init(),MUI.Checkout.Payment.bind.btpaypal.init()},btstandard:{init:function(){}},btpaypal:{init:function(){console.info("initializing PayPal OneTime Transaction");var a=MUI.Checkout.Payment.getBraintreeToken();braintree.setup(a,"custom",{paypal:{container:"paypal-container"},onPaymentMethodReceived:function(a){var b=MUI.Checkout.Payment.getBraintreeForm();$(b).submit(function(a){a.preventDefault()});var c=$(b).find('[data-muivalue="btpaypalnonce"]');MUI.Checkout.Payment.token=c.val(),$(c).val(a.nonce);var d=$(b).find(".mui-requirejs");if(""!==MUI.Settings.Endpoints.brainTreeSurface){var e="Process",f={nonce:$(c).val()};""!==MUI.Checkout.Payment.invoiceKey&&(e="Retry",f.invoiceKey=MUI.Checkout.Payment.invoiceKey),void 0!==MUI.Settings.Payments.braintreePayPalRequiresBtn&&MUI.Settings.Payments.braintreePayPalRequiresBtn?($(d).show(),$(d).click(function(a){a.preventDefault(),MUI.Checkout.Payment.postPayPalForm(e,f)})):MUI.Checkout.Payment.postPayPalForm(e,f)}}})}}},postPayPalForm:function(a,b){$.ajax({url:MUI.Settings.Endpoints.brainTreeSurface+a,type:"POST",data:b}).then(function(a){MUI.Checkout.Payment.handlePaymentResult(a,"BraintreePayPal.success")},function(a){MUI.Checkout.Payment.handlePaymentException(a)})},handlePaymentResult:function(a,b){a.Success?(MUI.emit("AddItem.added",a),MUI.emit(b,a),MUI.Notify.success(a.PaymentMethodName+" Success!")):(console.info(a),MUI.Notify.warn(a.PaymentMethodName+" Error!"))},handlePaymentException:function(a){MUI.Notify.error("There was an error"),MUI.Logger.captureError(a)},getBraintreeToken:function(){var a=MUI.Checkout.Payment.getBraintreeForm(),b=$(a).find("#Token");return $(b).val()},getBraintreeForm:function(){return $('[data-muiscript="braintree"]')}},MUI.init();
//# sourceMappingURL=merchello.ui.js.map
